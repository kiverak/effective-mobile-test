# Документация

Безопасность и роли

    Все эндепойнты, кроме POST /auth/login, требуют наличия JWT‑токена в заголовке Authorization в формате: Bearer <token>.

    Правила доступа:

        ADMIN: createCard, changeCardStatus, deleteCard, getAllCards.

        USER: getUserCards, requestBlockCard, getBalance, transferBetweenOwnCards.

    Если используется методная безопасность с @PreAuthorize, убедитесь, что для GrantedAuthority настроен префикс "ROLE_" (по умолчанию). Например, hasRole('ADMIN') будет соответствовать ROLE_ADMIN.

Поведение сортировки

    Для эндепойнтов с параметром sort API ожидает значения ASC или DESC и применяет их к фиксированному, безопасному полю (обычно id или createdAt).

    Не передавайте произвольные имена полей от клиента, чтобы избежать ошибок и утечек данных.

    Внутри системы ASC/DESC маппятся на Sort.by(direction, "id").

Валидация и обработка ошибок

    Предпочтительно использовать Bean Validation для DTO и параметров запроса:

        UUID: @NotNull (не использовать @NotEmpty для не‑строковых типов).

        Суммы: передавать как String и валидировать по шаблону ^\d+(\.\d{1,2})?$, затем конвертировать в BigDecimal с масштабом scale(2).

    Типичные ответы об ошибках:

        400 Bad Request — неверный UUID, значение enum, формат суммы, невозможное изменение состояния.

        401 Unauthorized — отсутствует или недействителен токен.

        403 Forbidden — недостаточно прав или карта не принадлежит пользователю.

        404 Not Found — карта с указанным ID не существует.

Обработка номера карты

    Хранить PAN в зашифрованном или токенизированном виде.

    Возвращать только maskedNumber с последними 4 цифрами.

    Никогда не возвращать полный PAN ни в одном API или логах.

Переводы

    Бизнес‑правила, которые должен обеспечивать CardTransferService:

        fromCardId ≠ toCardId.

        Оба идентификатора принадлежат одному владельцу.

        Статус карты‑отправителя — ACTIVE.

        Сумма > 0, с точностью до 2 знаков после запятой.

        Достаточно средств на карте‑отправителе.

        Использовать сериализуемую или оптимистическую блокировку для предотвращения двойного списания.

    При успешном переводе возвращать 200 OK с пустым телом (идемпотентность — по желанию; можно добавить transferId для отслеживания).

Параметры пагинации по умолчанию

    page = 0, size = 10, sort = ASC.

    Рекомендуется ограничивать size, чтобы избежать тяжёлых выборок (например, максимум 200).
